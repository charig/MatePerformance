# Config file for ReBench
# Config format is YAML (see http://yaml.org/ for detailed spec)

# this run definition will be choosen if no parameters are given to rebench.py
standard_experiment: all
standard_data_file: 'mate.data'

runs:
    number_of_data_points: 100
    
are_we_fast_yet:
    ## this is ignored by rebench
    iteration_numbers:
        fast_vm_macro:      &FAST_VM_MACRO      1500
        slow_vm_macro:      &SLOW_VM_MACRO      800
        fast_vm_micro:      &FAST_VM_MICRO      800
        slow_vm_micro:      &SLOW_VM_MICRO      400
        inlining: &INLINING_VALUES
#            - 1500
            - 2500
#            - 3500
#            - 4000
#            - 6000
#            - 8000

# settings and requirements for statistic evaluation
# Note, this is only used for explorative runs, for the final experiments, we
# rely soley on a fixed configuration of data points.
#statistics:
#    confidence_level: 0.95
 
# settings for quick runs, useful for fast feedback during experiments
quick_runs:
    number_of_data_points: 3
    max_time: 60   # time in seconds

# definition of benchmark suites
benchmark_suites:
    are-we-fast-som:
        gauge_adapter: RebenchLog
        command: &MACRO_CMD_ARE " -cp .:Core:LanguageFeatures:Json:Richards:DeltaBlue:NBody:GraphSearch:CD:Havlak:../../../Mate/Smalltalk:../../../Mate/Smalltalk/Mate:../../../Mate/Smalltalk/Mate/MOP:../../../Mate/Smalltalk/Mate/Compiler Harness %(benchmark)s %(variable)s"
        max_runtime: 7000
        variable_values: *FAST_VM_MACRO
        location: Benchmarks/AreWeFast/benchmarks/SOM
        benchmarks: &AWF
            - DeltaBlue:
                extra_args: 12000
            - Richards:
                extra_args: 100
            - Json:
                extra_args: 100
            - CD:
                extra_args: 100
            - Havlak:
                extra_args: 1500
            
            - Bounce:
                extra_args: 1500
            - List:
                extra_args: 1500
            - Mandelbrot:
                extra_args: 500
            - NBody:
                extra_args: 250000
            - Permute:
                extra_args: 1000
            - Queens:
                extra_args: 1000
            - Sieve:
                extra_args: 3000
            - Storage:
                extra_args: 1000
            - Towers:
                extra_args: 600    

    are-we-fast-java:
        gauge_adapter: RebenchLog
        location: Benchmarks/AreWeFast/benchmarks/Java
        command: " -cp benchmarks.jar Harness %(benchmark)s %(variable)s "
        variable_values: *FAST_VM_MACRO ## the number iterations measured
        max_runtime: 6000
        benchmarks: *AWF

    are-we-fast-js:
        gauge_adapter: RebenchLog
        location: Benchmarks/AreWeFast/benchmarks/JavaScript
        command: "harness.js %(benchmark)s %(variable)s "
        variable_values: *FAST_VM_MACRO ## the number iterations measured
        max_runtime: 6000
        benchmarks: *AWF

    are-we-fast-st:
        gauge_adapter: RebenchLog
        location: Benchmarks/AreWeFast/benchmarks/Smalltalk
        command: "AWFY_Pharo.image run.st %(benchmark)s %(variable)s "
        variable_values: *FAST_VM_MACRO ## the number iterations measured
        max_runtime: 6000
        benchmarks: *AWF
        
    #Configuration of the Delegation Proxies for read only
    readonly:
        gauge_adapter: RebenchLog
        command: &READONLY_CMD " -cp .:Mate/Immutability:Mate/Immutability/Handles:Mate/Immutability/DelegationProxies:../../Smalltalk:../../Smalltalk/Mate:../../Smalltalk/Mate/MOP:../../Smalltalk/Mate/Compiler BenchmarkHarness %(benchmark)s "
        max_runtime: 60000
        location: *MATE_LOCATION
        benchmarks:
            - SumKeys:
                extra_args: "1200 0 80"
            - DelegationProxiesSumKeys:
                extra_args: "1200 0 80"
        variable_values: *INLINING_VALUES                
    
    #Configuration of the Mate Handles for readonly
    readonly-handles:
        gauge_adapter: RebenchLog
        command: *READONLY_CMD
        max_runtime: 60000
        location: *MATE_LOCATION
        benchmarks:
            - ReadonlySumKeys:
                extra_args: "1200 0 80"
        variable_values: *INLINING_VALUES                

# VMs have a name and are specified by a path and the binary to be executed
virtual_machines:
    TruffleSOM-graal-enterprise:
        path: *IMPLEMENTATIONS_PATH
        binary: mate.sh
        args: "-A --oficial "
    TruffleMate-graal-enterprise:
        path: *IMPLEMENTATIONS_PATH 
        binary: mate.sh
        args: "-A --oficial --mate -activateMate"
    Java:
        path: *IMPLEMENTATIONS_PATH
        binary: java8.sh
#        args: "-Xms2048m -server "
    Node:
        path: *IMPLEMENTATIONS_PATH
        binary: node.sh
    Pharo:
      path: "Implementations/pharo"
      binary: pharo
                
# define the benchmarks to be executed for a re-executable benchmark run
experiments:
    AreWeFast:
        data_file: areWeFast.data
        executions:
          - TruffleSOM-graal-enterprise:
              benchmark:
                - are-we-fast-som
          - TruffleMate-graal-enterprise:
              benchmark:
                - are-we-fast-som
          - TruffleMate-graal-enterprise-naive:
              benchmark:
                - are-we-fast-som                
          - RTruffleSOM:
              benchmark:
                - are-we-fast-som                
          - RTruffleMate:
              benchmark:
                - are-we-fast-som                
          - Java:
              benchmark:
                - are-we-fast-java
          - Node:
              benchmark:
                - are-we-fast-js
          - Pharo:
              benchmark:
                - are-we-fast-st

    Readonly:
        data_file: readonly.data
        executions:
            - TruffleMate-graal-enterprise:
                benchmark: 
                   - readonly-handles
                   - readonly
            - RTruffleMate:
                benchmark: 
                   - readonly-handles
                   - readonly                                       
            - TruffleSOM-graal-enterprise:
                benchmark: 
                    readonly
            - RTruffleSOM:
                benchmark: 
                    readonly
